<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sakura.poetry.mapper.SysConfigMapper">

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, config_key, config_value, config_name, config_group, config_type, description,
        sort_order, status, created_by, created_time, updated_by, updated_time, is_deleted
    </sql>

    <!-- 根据配置键查询配置信息 -->
    <select id="selectByConfigKey" parameterType="string" resultType="com.sakura.poetry.entity.SysConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_config
        WHERE config_key = #{configKey} AND is_deleted = 0
    </select>

    <!-- 根据配置分组查询配置列表 -->
    <select id="selectByConfigGroup" parameterType="string" resultType="com.sakura.poetry.entity.SysConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_config
        WHERE config_group = #{configGroup} AND is_deleted = 0
        ORDER BY sort_order ASC, created_time DESC
    </select>

    <!-- 查询启用的配置列表 -->
    <select id="selectEnabledConfigList" resultType="com.sakura.poetry.entity.SysConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_config
        WHERE status = 1 AND is_deleted = 0
        ORDER BY config_group ASC, sort_order ASC, created_time DESC
    </select>

    <!-- 批量更新配置值 -->
    <update id="batchUpdateConfigValue" parameterType="java.util.List">
        <foreach collection="list" item="config" separator=";">
            UPDATE sys_config
            SET config_value = #{config.configValue}, updated_by = #{config.updatedBy}, updated_time = NOW()
            WHERE id = #{config.id}
        </foreach>
    </update>

    <!-- 逻辑删除 -->
    <update id="logicDeleteById" parameterType="long">
        UPDATE sys_config
        SET is_deleted = 1
        WHERE id = #{id}
    </update>

</mapper>